{% extends "base.html" %}

{% block title %}Browse Profiles - SkillBridge Africa{% endblock %}

{% block content %}
<!-- Header -->
<section class="bg-gradient-to-r from-primary-600 to-primary-800 text-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Browse Profiles</h1>
            <p class="text-xl text-primary-100">Discover talented professionals and potential clients</p>
        </div>
    </div>
</section>

<!-- Filters -->
<section class="bg-white shadow-md sticky top-0 z-40 border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <!-- Filter Toggle Button -->
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-gray-900">Browse Profiles</h2>
            <button type="button" id="filter-toggle" 
                    class="flex items-center space-x-2 text-primary-600 hover:text-primary-700 font-medium">
                <i class="fas fa-filter"></i>
                <span>Filters</span>
                <i class="fas fa-chevron-down transition-transform duration-200" id="filter-icon"></i>
            </button>
        </div>
        
        <!-- Filter Content -->
        <div id="filter-content" class="hidden">
            <form method="GET" class="space-y-4 lg:space-y-0 lg:flex lg:items-center lg:space-x-4">
            <!-- Search -->
            <div class="flex-1">
                <input type="text" name="q" value="{{ current_filters.q }}"
                       placeholder="Search by name, skills, or description..."
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
            </div>

            <!-- Profile Type -->
            <div>
                <select name="type" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">All Types</option>
                    <option value="PROFESSIONAL" {% if current_filters.type == 'PROFESSIONAL' %}selected{% endif %}>Professionals</option>
                    <option value="CLIENT" {% if current_filters.type == 'CLIENT' %}selected{% endif %}>Clients</option>
                </select>
            </div>

            <!-- Category -->
            <div>
                <select name="category" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                        <option value="{{ category }}" {% if current_filters.category == category %}selected{% endif %}>
                            {{ category }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Location -->
            <div>
                <select name="location" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">All Locations</option>
                    {% for county in counties %}
                        <option value="{{ county }}" {% if current_filters.location == county %}selected{% endif %}>
                            {{ county }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Availability -->
            <div>
                <select name="availability" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    <option value="">Any Availability</option>
                    <option value="Available" {% if current_filters.availability == 'Available' %}selected{% endif %}>Available</option>
                    <option value="Busy" {% if current_filters.availability == 'Busy' %}selected{% endif %}>Busy</option>
                </select>
            </div>

            <!-- Search Button -->
            <div>
                <button type="submit" class="bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition">
                    <i class="fas fa-search mr-2"></i>Search
                </button>
            </div>
            </form>

            <!-- Active Filters Display -->
        {% if current_filters.q or current_filters.type or current_filters.category or current_filters.location or current_filters.availability %}
        <div class="mt-4 flex flex-wrap gap-2">
            <span class="text-sm text-gray-600">Active filters:</span>
            {% if current_filters.q %}
                <span class="bg-primary-100 text-primary-800 px-3 py-1 rounded-full text-sm">
                    Search: "{{ current_filters.q }}"
                    <a href="{{ url_for('public.browse', type=current_filters.type, category=current_filters.category, location=current_filters.location, availability=current_filters.availability) }}" class="ml-1 text-primary-600 hover:text-primary-800">&times;</a>
                </span>
            {% endif %}
            {% if current_filters.type %}
                <span class="bg-accent-100 text-accent-800 px-3 py-1 rounded-full text-sm">
                    Type: {{ current_filters.type }}
                    <a href="{{ url_for('public.browse', q=current_filters.q, category=current_filters.category, location=current_filters.location, availability=current_filters.availability) }}" class="ml-1 text-accent-600 hover:text-accent-800">&times;</a>
                </span>
            {% endif %}
            {% if current_filters.category %}
                <span class="bg-earth-100 text-earth-800 px-3 py-1 rounded-full text-sm">
                    Category: {{ current_filters.category }}
                    <a href="{{ url_for('public.browse', q=current_filters.q, type=current_filters.type, location=current_filters.location, availability=current_filters.availability) }}" class="ml-1 text-earth-600 hover:text-earth-800">&times;</a>
                </span>
            {% endif %}
            <a href="{{ url_for('public.browse') }}" class="text-sm text-red-600 hover:text-red-800">Clear all filters</a>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Results -->
<section class="py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Results Header -->
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900">
                {% if profiles.total %}
                    {{ profiles.total }} Profile{{ 's' if profiles.total != 1 else '' }} Found
                {% else %}
                    No Profiles Found
                {% endif %}
            </h2>

            {% if current_user.is_authenticated %}
                <a href="{{ url_for('profiles.create_profile') }}"
                   class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition">
                    <i class="fas fa-plus mr-2"></i>Create Profile
                </a>
            {% endif %}
        </div>

        {% if profiles.items %}
            <!-- Profiles Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                {% for profile in profiles.items %}
                    {% include 'components/profile_card.html' %}
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if profiles.pages > 1 %}
            <div class="flex justify-center items-center space-x-2">
                {% if profiles.has_prev %}
                    <a href="{{ url_for('public.browse', page=profiles.prev_num, **current_filters) }}"
                       class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                {% endif %}

                {% for page_num in profiles.iter_pages() %}
                    {% if page_num %}
                        {% if page_num != profiles.page %}
                            <a href="{{ url_for('public.browse', page=page_num, **current_filters) }}"
                               class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                                {{ page_num }}
                            </a>
                        {% else %}
                            <span class="px-3 py-2 bg-primary-600 text-white rounded-lg">{{ page_num }}</span>
                        {% endif %}
                    {% else %}
                        <span class="px-3 py-2">...</span>
                    {% endif %}
                {% endfor %}

                {% if profiles.has_next %}
                    <a href="{{ url_for('public.browse', page=profiles.next_num, **current_filters) }}"
                       class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                {% endif %}
            </div>
            {% endif %}
        {% else %}
            <!-- No Results -->
            <div class="text-center py-16">
                <div class="bg-gray-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-search text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4">No profiles found</h3>
                <p class="text-gray-600 mb-8">Try adjusting your search criteria or browse all profiles.</p>

                <div class="space-y-4 sm:space-y-0 sm:space-x-4 sm:flex sm:justify-center">
                    <a href="{{ url_for('public.browse') }}"
                       class="bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700 transition block sm:inline-block">
                        Browse All Profiles
                    </a>
                    {% if not current_user.is_authenticated %}
                        <a href="{{ url_for('auth.signup') }}"
                           class="bg-accent-600 text-white px-6 py-3 rounded-lg hover:bg-accent-700 transition block sm:inline-block">
                            Create Your Profile
                        </a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filterToggle = document.getElementById('filter-toggle');
        const filterContent = document.getElementById('filter-content');
        const filterIcon = document.getElementById('filter-icon');

        if (filterToggle && filterContent && filterIcon) {
            filterToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const isHidden = filterContent.classList.contains('hidden');
                if (isHidden) {
                    filterContent.classList.remove('hidden');
                    filterIcon.classList.add('rotate-180');
                } else {
                    filterContent.classList.add('hidden');
                    filterIcon.classList.remove('rotate-180');
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const isClickInsideFilter = filterToggle.contains(event.target) || filterContent.contains(event.target);
                if (!isClickInsideFilter && !filterContent.classList.contains('hidden')) {
                    filterContent.classList.add('hidden');
                    filterIcon.classList.remove('rotate-180');
                }
            });
        }
    });
</script>
{% endblock %}